<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>紙ヒコーキゲーム（スマホは縦間隔広め）</title>
<style>
  body { 
    margin:0; background:#000; display:flex; flex-direction:column; 
    align-items:center; color:#fff; font-family:monospace; position: relative;
  }
  canvas { background:#000; touch-action:none; }
  #controls {
    margin-top: 10px; font-size: 14px; text-align: center; color: #0f0;
  }
  .cat {
    position: absolute; width: 120px; pointer-events: none;
  }
</style>
</head>
<body>
  <canvas id="game" width="320" height="480"></canvas>
  <div id="controls">
    PC: ← / → で操作, Spaceでリスタート<br>
    スマホ: 左タップ=左, 右タップ=右, タップでリスタート
  </div>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// --- 背景 ---
const bg1 = new Image(); bg1.src = "bg1.png";
const bg2 = new Image(); bg2.src = "bg2.png";
let bgY = 0;

// --- 背景フィルター（ステージ1のみ） ---
const bgFilters = [
  "rgba(255,0,0,0.3)","rgba(0,255,0,0.3)","rgba(0,0,255,0.3)",
  "rgba(255,255,0,0.3)","rgba(255,0,255,0.3)","rgba(0,255,255,0.3)",
  "rgba(255,255,255,0.2)"
];
let bgFilterIndex = 0;

// --- 紙ヒコーキ色（ステージ2で変化） ---
const planeColors = ["#fff","#ff0","#0ff","#f0f","#0f0","#f00","#00f"];
let planeColor = "#fff";

// --- 入力 ---
let keys = {};
document.addEventListener("keydown", e => {
  if(!keys[e.code]){
    if(e.code==="ArrowLeft"||e.code==="KeyA"){ plane.angle=Math.max(plane.angle-0.3,-1.2); }
    if(e.code==="ArrowRight"||e.code==="KeyD"){ plane.angle=Math.min(plane.angle+0.3,1.2); }
  }
  keys[e.code]=true;
  if(e.code==="Space"&&(state==="gameover"||state==="goal")){ restartGame(); }
});
document.addEventListener("keyup", e=>keys[e.code]=false);

// --- タッチ操作 ---
canvas.addEventListener("touchstart", e=>{
  const touch=e.touches[0];
  const rect=canvas.getBoundingClientRect();
  const x=touch.clientX-rect.left;
  if(state==="gameover"||state==="goal"){ restartGame(); return; }
  if(x<canvas.width/2){ plane.angle=Math.max(plane.angle-0.3,-1.2); }
  else { plane.angle=Math.min(plane.angle+0.3,1.2); }
});

// --- 紙ヒコーキ ---
const plane={x:160,y:400,scale:2.0,speed:0.018,angle:0,vx:0};

// --- データ ---
let walls=[]; let characters=[]; let lastSpawn=0;
let spawnInterval=1600; let scrollSpeed=0.8; let gapW=140;

// --- スマホ判定して間隔調整 ---
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
if(isMobile){
  spawnInterval = 2200; // ★スマホは縦間隔広め
}

// --- 状態 ---
let state="running"; let score=0; let level=1; let stage=1; let goalTapeTime=0;
let invincible=false;
let dogSpeedFactor = 1;

// --- （以下 update / render / drawDog などは前と同じ） ---
</script>
</body>
</html>
